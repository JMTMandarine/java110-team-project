<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="indiesker.java110.ms.dao.AviDao">

	<resultMap type="Avi" id="aviMap">
		<id column="abno" property="aviboardno" />
		<result column="titl" property="title" />
		<result column="cdt" property="cdt" />
		<result column="stm" property="urlid" />
		<result column="name" property="teamname" />
		<result column="city" property="city" />
		<result column="genre" property="teamgenre" />
		<result column="cont" property="content" />
		<result column="lcnt" property="avilikecount" />
		<result column="bno" property="buskerno" />
		<result column="phot" property="teamPhoto" />
		<result column="lcnt" property="likeAvi" />
	</resultMap>

	<select id="findByNo" resultMap="aviMap" parameterType="int">
		SELECT
		abno, titl, cont, cdt, stm, bno
		FROM avi
		WHERE abno=#{no}
	</select>

	<!-- 피드동영상 상세조회 -->
	<select id="findfeedavibyAbno" resultMap="aviMap" parameterType="int">
		select A.titl, A.stm, B.phot, B.name, B.genre, B.city, A.cont,A.lcnt
		from avi A, busk B
		where A.bno=B.bno
		and A.abno=#{no}
	</select>

	<!-- 동영상상세조회 -->
	<select id="findByAviNo" resultMap="aviMap" parameterType="int">
		SELECT a.titl, a.stm, b.name, b.genre, b.city, a.cont, a.lcnt
		FROM busk
		b, avi a
		WHERE b.bno=a.bno
		AND a.abno=#{value}
	</select>

	<!-- 최신영상3개 조회(개인피드) -->
	<select id="findRecent" resultMap="aviMap" parameterType="int">
		SELECT a.abno,a.stm,a.titl
		FROM busk b, avi a
		WHERE b.bno=a.bno
		AND
		b.bno=#{value}
		ORDER BY cdt desc<!-- 여기 수정해야함 -->
	</select>

	<insert id="insert" parameterType="avi" useGeneratedKeys="true"
		keyColumn="abno" keyProperty="aviboardno">
		insert into avi(abno,titl,cont,cdt,stm,bno)
		values(#{aviboardno},#{title},#{content},now(),#{url},#{no})<!-- 자동으로 증가하게! -->
	</insert>
	
	<!-- 최신영상 조회(메인) -->
    <select id="findAll" resultMap="aviMap">
        SELECT a.abno,a.stm,a.titl, b.name
        FROM busk b, avi a
        WHERE b.bno=a.bno
        ORDER BY cdt desc
        LIMIT 8<!-- 여기 수정해야함 -->
    </select>
    
    <!-- 인기영상 조회(메인) -->
    <select id="findbypopul" resultMap="aviMap">
        SELECT a.abno,a.stm,a.titl, af.lcnt, b.name
        FROM busk b, avi a, avi_fav af
        WHERE b.bno=a.bno
          AND a.abno=af.abno
        ORDER BY lcnt desc
        LIMIT 8<!-- 여기 수정해야함 -->
    </select>

</mapper>









