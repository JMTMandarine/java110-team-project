<?xml version="1.0" encoding="UTF-8"?>
<!-- MemberDao 클래스가 사용할 SQL이 들어 있는 파일 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="indiesker.java110.ms.dao.BuskerScheduleDao">

    <resultMap type="BuskerSchedule" id="perbuskerMap">
        <id column="brno"  property="brno"/>
        <result column="name"  property="name"/>
        <result column="addr"    property="addr"/>
        <result column="sdt"    property="sdt"/>
        <result column="edt"    property="edt"/>
        <result column="cnt"    property="cnt"/>
        <result column="flag"    property="flag"/>
        <result column="cdt"    property="cdt"/>
        <result column="x"    property="x"/>
        <result column="y"    property="y"/>
    </resultMap>

    <!-- 스케줄조회 : 확정 버스커 스케줄 출력하는 쿼리  -->
    <select id="findfixdSchedule" resultMap="perbuskerMap" parameterType="map">
    SELECT 
           BR.brno,
           S.name as name,
           S.bas_addr as addr,
           MIN(SC.sdt) as sdt,
           MAX(SC.edt) as edt,
           BR.cnt,
           BS.flag, 
           BR.cdt, 
           S.x, 
           S.y 
      FROM busk B, busk_req BR, busk_stag BS,stag_sche SC, sup S
     WHERE B.bno=BR.bno
       AND BR.brno=BS.brno 
       AND BS.ssno=SC.ssno
       AND SC.sno = S.sno
       AND BS.flag=2
  GROUP BY BS.brno
  limit #{rowNo}, #{size}
 </select>
 
 <!-- 스케줄조회 : 확정 버스커 스케줄 출력하는 쿼리  -->
 <select id="findMyAllSchedule" resultMap="perbuskerMap" parameterType="map">
    SELECT 
           BR.brno,
           S.name as name,
           S.bas_addr as addr,
           MIN(SC.sdt) as sdt,
           MAX(SC.edt) as edt,
           BR.cnt,
           BS.flag, 
           BR.cdt, 
           S.x, 
           S.y 
      FROM busk B, busk_req BR, busk_stag BS,stag_sche SC, sup S
     WHERE B.bno=BR.bno
       AND BR.brno=BS.brno 
       AND BS.ssno=SC.ssno
       AND SC.sno = S.sno
       AND BR.bno=#{no}
  GROUP BY BS.brno
  limit #{rowNo}, #{size}
 </select>
 
 
 <!-- 스케줄조회 : 확정 버스커 스케줄 출력하는 쿼리  -->
 <select id="findbydate" resultMap="perbuskerMap" parameterType="map">
    SELECT 
           BR.brno,
           S.name as name,
           S.bas_addr as addr,
           MIN(SC.sdt) as sdt,
           MAX(SC.edt) as edt,
           BR.cnt,
           BS.flag, 
           BR.cdt, 
           S.x, 
           S.y 
      FROM busk B, busk_req BR, busk_stag BS,stag_sche SC, sup S
     WHERE B.bno=BR.bno
       AND BR.brno=BS.brno 
       AND BS.ssno=SC.ssno
       AND SC.sno = S.sno
       AND BR.bno=#{bno}
       AND SUBSTR(SC.sdt,1,10) = #{date}
  GROUP BY BS.brno
 </select>
</mapper>









