<?xml version="1.0" encoding="UTF-8"?>
<!-- MemberDao 클래스가 사용할 SQL이 들어 있는 파일 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="indiesker.java110.ms.dao.MemberDao">
    
    <resultMap type="member" id="memberMap">
    <id column="mno" property="no"/>
    <result column="id" property="id"/>
    <result column="email" property="email"/>
    <result column="pwd" property="password"/>
    <result column="nik" property="nickname"/>
    <result column="phot" property="photo"/>
    </resultMap>
    
	<insert id="insert" parameterType="member"
		useGeneratedKeys="true" keyColumn="mno" keyProperty="no">
		insert into memb(id,email,pwd,nik,phot,cdt,genre1,genre2,genre3,yn)
		values(#{id},#{email},password(#{password}),#{nickname},
		#{photo},now(),
		<foreach collection="genre" item="genre" separator=",">
		#{genre}
		</foreach>
		,'n')
	</insert>

    <select id="checkId" parameterType="string" resultType="int">
    select count(*) from memb where id=#{id}
    </select>
    
    <select id="checkEmail" parameterType="string" resultType="int">
    select count(*) from memb where email=#{email}
    </select>
    
    <select id="checkNickname" parameterType="string" resultType="int">
    select count(*) from memb where nik=#{nickname}
    </select>
    
    <select id="findByEmailPassword" parameterType="map" resultMap="memberMap">
    select mno, id, email, nik, phot
      from memb 
     where id=#{id} and pwd=password(#{password})
    </select>
    
    <select id="findByIdNick" parameterType="map" resultMap="memberMap">
    select mno, id, email, nik, phot
      from memb 
     where id=#{id} and nik=#{nickname}
    </select>
</mapper>

