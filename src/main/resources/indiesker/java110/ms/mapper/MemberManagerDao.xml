<?xml version="1.0" encoding="UTF-8"?>
<!-- MemberDao 클래스가 사용할 SQL이 들어 있는 파일 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="indiesker.java110.ms.dao.MemberManagerDao">

    <resultMap type="Supporter" id="SupporterMap">
        <result column="name"   property="name"/>
        <result column="capa"  property="capa"/>
        <result column="det_addr"    property="detailaddr"/>
        <result column="tel"   property="tel"/>
        <result column="etc"   property="message"/>
    </resultMap>
    
       <resultMap type="Busker" id="BuskerMap">
        <result column="name"   property="teamname"/>
        <result column="city"  property="city"/>
        <result column="genre"    property="teamgenre"/>
        <result column="tel"   property="tel"/>
        <result column="intro"   property="message"/>
         <result column="avi1"   property="avi1"/>
          <result column="avi2"   property="avi2"/>
    </resultMap>


<!-- 전체 -->
<select id="findAll" resultType="MemberManager" parameterType="map">
SELECT m.id,m.nik,m.email,m.flag,m.cdt,m.memo
FROM memb as m


</select>

<!-- 선택 -->
<select id="findselect" resultType="MemberManager" parameterType="map">
SELECT id, nik, email, flag, cdt, memo
FROM memb 

<!-- <where>
<choose>
<when test="flag == 0">

</when>
<when test="flag ==1">
flag = 1
</when>

<when test="flag ==2">
flag = 2
</when>

<when test="flag ==3">
flag = 3
</when>

<when test="value ==4">
flag = 4
</when>
</choose>
</where> -->

limit #{rowNo}, #{size} 
</select>



<select id="searchSelect" resultType="MemberManager" parameterType="map">
SELECT id,nik,email,flag,cdt,memo
FROM memb

<where>
<choose>
<when test="flag == 0">
cdt between #{cdt1} and #{cdt2}
</when>
<when test="flag == 1">
cdt = #{cdt2}
</when>
<when test="flag == 2">
nik = #{text}
</when>
<when test="flag == 3">
email = #{text}
</when>
</choose>
</where>
</select> 

<update id="update" parameterType="Map">
update memb
    SET memo = #{memo}
    WHERE nik = #{nik}
</update>


<select id="detailMember" resultType="MemberManager" parameterType="String">
SELECT id,email,nik,phot,memo,genre0,genre1,genre2
FROM memb
where id = #{id}
</select>

<select id="detailBusker" resultType="Busker" parameterType="String">
SELECT m.id,m.email,m.nik,m.memo,b.name,b.genre,b.city,b.inst,b.strm,b.intro,b.phot
FROM memb as m ,busk as b
WHERE m.mno = b.bno
and m.id = #{id}
</select>

<select id="detailSupporter" resultType="Supporter" parameterType="String">
SELECT m.id,m.email,m.nik,m.memo,s.name,s.det_addr,s.genre,s.capa,s.tel,s.etc
FROM memb as m ,sup as s  
WHERE m.mno = s.sno
and m.id = #{id}
</select>

<select id="gradleBusker" resultType="GradleMember" parameterType="Map">
SELECT m.nik,b.name,b.genre,m.email,m.flag,b.bno
FROM memb as m , busk as b
where m.mno = b.bno
and m.flag = '2'
and b.per = 'n'
limit #{rowNo}, #{size} 
</select>

<select id="gradleSupporter" resultType="GradleMember" parameterType="Map">
SELECT m.nik,s.name,s.genre,m.email,m.flag,s.sno
FROM memb as m , sup as s
where m.mno = s.sno
and m.flag = '3'
and s.per = 'n'
limit #{rowNo}, #{size} 
</select>



<select id="gradleAjaxBusker" resultType="GradleMember" parameterType="map">
SELECT m.nik,b.name,b.genre,m.email,m.flag,b.bno
FROM memb as m , busk as b
where m.mno = b.bno
and m.flag = '2'
and b.per ='n'
limit #{rowNo}, #{size} 
</select>

<select id="gradleAjaxSupporter" resultType="GradleMember" parameterType="map">
SELECT m.nik,s.name,s.genre,m.email,m.flag,s.sno
FROM memb as m , sup as s
where m.mno = s.sno
and m.flag = '3'
and s.per = 'n'
limit #{rowNo}, #{size} 
</select>

<select id="gradleAjaxBuskerSelect" resultType="GradleMember" parameterType="map">
SELECT m.nik,b.name,b.genre,m.email,m.flag,b.bno
FROM memb as m , busk as b
where  m.mno = b.bno 
and b.per = 'n' and 
<if test='sflag.equals("email")'>
m.email = #{text}
</if>
<if test='sflag.equals("nik")'>
m.nik = #{text}
</if>
limit #{rowNo}, #{size} 
</select> 

<select id="gradleAjaxSupporterSelect" resultType="GradleMember" parameterType="map">
SELECT m.nik,s.name,s.genre,m.email,m.flag,s.sno
FROM memb as m , sup as s
where m.mno = s.sno 
and s.per = 'n' and
<if test='sflag.equals("email")'>
m.email = #{text}
</if>
<if test='sflag.equals("nik")'>
m.nik = #{text}
</if>
limit #{rowNo}, #{size} 
</select> 


<select id="findbyNo" resultMap="SupporterMap" parameterType="int">
SELECT name, capa,det_addr,genre,tel,etc
FROM sup
where sno = #{no}
</select>

<select id="fidnBuskbyNo" resultMap="BuskerMap" parameterType="int">
SELECT name,city,genre,tel,intro,avi1,avi2
FROM busk
where bno = #{no}
</select>

 </mapper>